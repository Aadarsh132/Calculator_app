<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Glass Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Noto+Sans+Devanagari:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Dark Theme (Professional Graphite) */
            --bg-image: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            --panel-bg: rgba(31, 41, 55, 0.95);
            --panel-border: rgba(255, 255, 255, 0.05);
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            
            --btn-bg: rgba(255, 255, 255, 0.05);
            --btn-text: #f3f4f6;
            --btn-hover: rgba(255, 255, 255, 0.1);
            
            --func-text: #60a5fa; 
            
            --op-bg: rgba(255, 255, 255, 0.05);
            --op-text: #fbbf24;
            --op-hover: rgba(255, 255, 255, 0.1);
            
            --submit-bg: #f59e0b;
            --submit-hover: #d97706;
            
            --toggle-icon: #fbbf24;
            --lang-icon: #9ca3af;
            --sci-icon: #a78bfa; 
            --history-icon: #2dd4bf; 
            --back-btn-bg: #ef4444; 
            --back-btn-text: #ffffff;
            
            --history-panel-bg: rgba(17, 24, 39, 0.98);
        }

        [data-theme="light"] {
            /* Light Theme */
            --bg-image: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
            --panel-bg: rgba(226, 232, 240, 0.9); 
            --panel-border: rgba(255, 255, 255, 0.4);
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            
            --btn-bg: #ffffff;
            --btn-text: #334155;
            --btn-hover: #f8fafc;
            
            --func-text: #2563eb;
            
            --op-bg: #e2e8f0;
            --op-text: #d97706;
            --op-hover: #cbd5e1;
            
            --submit-bg: #f59e0b;
            --submit-hover: #d97706;
            
            --toggle-icon: #334155;
            --lang-icon: #334155;
            --sci-icon: #7c3aed;
            --history-icon: #0d9488;
            --back-btn-bg: #ef4444;
            --back-btn-text: #ffffff;
            
            --history-panel-bg: rgba(241, 245, 249, 0.98);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-image);
            background-size: cover;
            background-attachment: fixed;
            transition: background 0.5s ease;
        }
        
        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--panel-border);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.15);
            transition: all 0.4s ease;
        }
        
        .font-hindi {
            font-family: 'Noto Sans Devanagari', sans-serif !important;
        }

        .calc-btn {
            background: var(--btn-bg);
            backdrop-filter: blur(4px);
            border: 0;
            color: var(--btn-text);
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .calc-btn:hover {
            background: var(--btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .calc-btn:active {
            transform: scale(0.98) translateY(0);
        }

        /* Scientific keys hidden in standard mode */
        .sci-hidden .sci-key {
            display: none;
        }

        /* Standard keys hidden in scientific mode */
        #calculator-frame:not(.sci-hidden) .std-key {
            display: none;
        }

        .btn-operator {
            background: var(--op-bg);
            color: var(--op-text);
            font-weight: 600;
        }
        .btn-operator:hover {
            background: var(--op-hover);
        }

        .btn-function {
            color: var(--func-text);
            font-size: 0.9rem;
        }
        
        .btn-submit {
            background: var(--submit-bg);
            color: white;
        }
        .btn-submit:hover {
            background: var(--submit-hover);
        }

        #current-operand { color: var(--text-primary); }

        .display-scroll::-webkit-scrollbar { height: 4px; width: 4px; }
        .display-scroll::-webkit-scrollbar-track { background: transparent; }
        .display-scroll::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.5); border-radius: 10px; }
        
        /* History Panel Styles */
        .history-panel {
            background: var(--history-panel-bg);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .history-item {
            border-bottom: 1px solid var(--panel-border);
        }
        .history-item:last-child { border-bottom: none; }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center p-4" data-theme="dark">

    <div id="calculator-frame" class="glass-panel w-full max-w-[360px] rounded-[3rem] shadow-2xl overflow-hidden flex flex-col relative sci-hidden">
        
        <!-- Header / Toggles -->
        <div class="absolute top-4 left-5 z-20 flex gap-3">
             <!-- Science Mode Toggle -->
             <button id="sci-toggle" class="h-10 px-0 w-10 rounded-full flex items-center justify-center transition-all duration-300 ease-in-out hover:scale-105 focus:outline-none shadow-md overflow-hidden" style="background: var(--btn-bg); color: var(--sci-icon);">
                <div class="flex items-center gap-2 px-3">
                    <i class="fas fa-flask text-lg" id="sci-icon"></i>
                    <span id="sci-text" class="text-sm font-semibold whitespace-nowrap opacity-0 w-0 transition-all duration-300">Back</span>
                </div>
            </button>

             <!-- Language Toggle -->
             <button id="lang-toggle" class="w-10 h-10 rounded-full flex items-center justify-center transition-transform hover:scale-110 focus:outline-none shadow-md" style="background: var(--btn-bg); color: var(--lang-icon);">
                <span class="text-sm font-bold">अ</span>
            </button>
            
            <!-- Theme Toggle -->
            <button id="theme-toggle" class="w-10 h-10 rounded-full flex items-center justify-center transition-transform hover:scale-110 focus:outline-none shadow-md" style="background: var(--btn-bg); color: var(--toggle-icon);">
                <i class="fas fa-sun text-lg" id="theme-icon"></i>
            </button>

            <!-- History Toggle -->
            <button id="history-toggle" class="w-10 h-10 rounded-full flex items-center justify-center transition-transform hover:scale-110 focus:outline-none shadow-md" style="background: var(--btn-bg); color: var(--history-icon);">
                <i class="fas fa-history text-lg"></i>
            </button>
        </div>

        <!-- History Overlay Panel -->
        <div id="history-view" class="history-panel absolute inset-x-0 bottom-0 top-[4.5rem] z-30 transform translate-y-full flex flex-col rounded-t-[2.5rem] p-6 pt-8 backdrop-blur-md">
            <div class="flex justify-between items-center mb-4 px-2">
                <h3 class="text-lg font-semibold" style="color: var(--text-primary)">History</h3>
                <button id="clear-history" class="text-sm font-medium text-red-400 hover:text-red-500 transition-colors">Clear All</button>
            </div>
            
            <div id="history-list" class="flex-1 overflow-y-auto display-scroll space-y-0">
                <div class="text-center text-sm mt-10 opacity-50 italic" style="color: var(--text-secondary)">No history yet</div>
            </div>
        </div>

        <!-- Display Section -->
        <div class="p-6 pb-2 flex flex-col justify-end h-36 pt-16">
            <div id="current-operand" class="text-right text-4xl font-light tracking-wide break-all display-scroll overflow-x-auto overflow-y-hidden whitespace-nowrap pb-2 min-h-[60px] flex items-end justify-end">0</div>
        </div>

        <!-- Keypad Grid -->
        <div id="keypad" class="grid grid-cols-4 gap-3 p-5 pt-2 transition-all duration-300">
            
            <!-- Row 1 -->
            <button data-val="sin(" class="calc-btn btn-function h-14 rounded-full sci-key">sin</button>
            <button data-val="cos(" class="calc-btn btn-function h-14 rounded-full sci-key">cos</button>
            <button data-val="tan(" class="calc-btn btn-function h-14 rounded-full sci-key">tan</button>
            <button data-action="clear" class="calc-btn h-14 rounded-full text-cyan-500 font-semibold">AC</button>
            <button data-action="delete" class="calc-btn h-14 rounded-full text-red-400">⌫</button>

            <!-- Row 2 -->
            <button data-val="log(" class="calc-btn btn-function h-14 rounded-full sci-key">log</button>
            <button data-val="ln(" class="calc-btn btn-function h-14 rounded-full sci-key">ln</button>
            <button data-val="e" class="calc-btn btn-function h-14 rounded-full sci-key">e</button>
            <button data-val="%" class="calc-btn btn-function h-14 rounded-full">%</button>
            <button data-val="÷" class="calc-btn btn-operator h-14 rounded-full">÷</button>

            <!-- Row 3 -->
            <button data-val="^" class="calc-btn btn-function h-14 rounded-full sci-key">xʸ</button>
            <button data-val="7" data-type="num" class="calc-btn h-14 rounded-full text-xl">7</button>
            <button data-val="8" data-type="num" class="calc-btn h-14 rounded-full text-xl">8</button>
            <button data-val="9" data-type="num" class="calc-btn h-14 rounded-full text-xl">9</button>
            <button data-val="×" class="calc-btn btn-operator h-14 rounded-full">×</button>

            <!-- Row 4 -->
            <button data-val="√(" class="calc-btn btn-function h-14 rounded-full sci-key">√</button>
            <button data-val="4" data-type="num" class="calc-btn h-14 rounded-full text-xl">4</button>
            <button data-val="5" data-type="num" class="calc-btn h-14 rounded-full text-xl">5</button>
            <button data-val="6" data-type="num" class="calc-btn h-14 rounded-full text-xl">6</button>
            <button data-val="-" class="calc-btn btn-operator h-14 rounded-full">−</button>

            <!-- Row 5 -->
            <button data-val="π" class="calc-btn btn-function h-14 rounded-full sci-key">π</button>
            <button data-val="1" data-type="num" class="calc-btn h-14 rounded-full text-xl">1</button>
            <button data-val="2" data-type="num" class="calc-btn h-14 rounded-full text-xl">2</button>
            <button data-val="3" data-type="num" class="calc-btn h-14 rounded-full text-xl">3</button>
            <button data-val="+" class="calc-btn btn-operator h-14 rounded-full">+</button>

            <!-- Row 6 -->
            <button data-val="(" class="calc-btn btn-function h-14 rounded-full text-lg w-full bg-gray-500 bg-opacity-20 text-indigo-300 sci-key">(</button>
            <button data-val=")" class="calc-btn btn-function h-14 rounded-full text-lg w-full bg-gray-500 bg-opacity-20 text-indigo-300 sci-key">)</button>
            
            <button data-action="bracket" class="calc-btn btn-function h-14 rounded-full text-xl bg-gray-500 bg-opacity-20 text-indigo-300 std-key">( )</button>
            
            <button id="btn-zero" data-val="0" data-type="num" class="calc-btn h-14 rounded-full text-xl">0</button>
            <button data-val="." class="calc-btn h-14 rounded-full text-xl">.</button>
            <button data-action="equals" class="calc-btn btn-submit h-14 rounded-full text-2xl">=</button>
        </div>
    </div>

    <script>
        class Calculator {
            constructor(displayElement, historyListElement) {
                this.displayElement = displayElement;
                this.historyListElement = historyListElement;
                this.expression = '';
                this.result = '';
                this.locale = 'en';
                this.history = [];
                this.updateDisplay();
            }
            
            setLocale(lang) {
                this.locale = lang;
                this.updateDisplay();
                this.renderHistory(); 
            }

            toHindi(str) {
                if (!str) return '';
                const hindiDigits = ['०', '१', '२', '३', '४', '५', '६', '७', '८', '९'];
                return str.toString().replace(/[0-9]/g, w => hindiDigits[+w]);
            }
            
            formatForDisplay(str) {
                if (!str) return '0';
                if (this.locale === 'hi') {
                    return this.toHindi(str);
                }
                return str;
            }

            clear() {
                this.expression = '';
                this.result = '';
                this.updateDisplay();
            }
            
            clearHistory() {
                this.history = [];
                this.renderHistory();
            }

            addToHistory(exp, res) {
                if (!exp || !res || exp === res) return;
                this.history.unshift({ expression: exp, result: res });
                if (this.history.length > 20) this.history.pop();
                this.renderHistory();
            }

            renderHistory() {
                this.historyListElement.innerHTML = '';
                if (this.history.length === 0) {
                    this.historyListElement.innerHTML = `<div class="text-center text-sm mt-10 opacity-50 italic" style="color: var(--text-secondary)">No history yet</div>`;
                    return;
                }
                this.history.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'history-item p-3 flex flex-col items-end cursor-pointer hover:bg-white/5 transition-colors';
                    const expDisplay = this.formatForDisplay(item.expression);
                    const resDisplay = this.formatForDisplay(item.result);
                    el.innerHTML = `
                        <div class="text-xs opacity-70 mb-1" style="color: var(--text-secondary)">${expDisplay} =</div>
                        <div class="text-lg font-medium" style="color: var(--text-primary)">${resDisplay}</div>
                    `;
                    el.addEventListener('click', () => {
                        this.expression = item.result;
                        this.updateDisplay();
                        document.getElementById('history-toggle').click();
                    });
                    this.historyListElement.appendChild(el);
                });
            }

            delete() {
                const funcs = ["sin(", "cos(", "tan(", "log(", "sqrt(", "ln("];
                let matched = false;
                for (let f of funcs) {
                    if (this.expression.endsWith(f)) {
                        this.expression = this.expression.slice(0, -f.length);
                        matched = true;
                        break;
                    }
                }
                if (!matched) {
                    this.expression = this.expression.slice(0, -1);
                }
                this.updateDisplay();
            }

            append(val) {
                this.expression += val;
                this.updateDisplay();
            }

            bracket() {
                const openCount = (this.expression.match(/\(/g) || []).length;
                const closeCount = (this.expression.match(/\)/g) || []).length;
                const lastChar = this.expression.slice(-1);
                const isNum = /[0-9.)]/.test(lastChar);
                if (openCount > closeCount && isNum) {
                    this.append(')');
                } else {
                    this.append('(');
                }
            }

            compute() {
                try {
                    let originalExpression = this.expression;
                    let evalString = this.expression;

                    // Fix: Implicit multiplication for Pi, e, Root, and Brackets
                    // Inserts * between a digit and (π, e, √, or open parenthesis)
                    evalString = evalString.replace(/(\d)(?=[πe√\(])/g, '$1*');
                    // Inserts * between a closing parenthesis and (π, e, √, or open parenthesis)
                    evalString = evalString.replace(/(\))(?=[πe√\(])/g, '$1*');

                    // Standard replacements
                    evalString = evalString.replace(/×/g, '*');
                    evalString = evalString.replace(/÷/g, '/');
                    evalString = evalString.replace(/−/g, '-');
                    evalString = evalString.replace(/π/g, 'Math.PI');
                    evalString = evalString.replace(/e/g, 'Math.E');
                    
                    // Fix: Square Root Replacement
                    evalString = evalString.replace(/√/g, 'sqrt'); 
                    
                    evalString = evalString.replace(/\^/g, '**');
                    evalString = evalString.replace(/%/g, '/100');

                    const toRad = (deg) => deg * Math.PI / 180;
                    const sin = (val) => Math.sin(toRad(val));
                    const cos = (val) => Math.cos(toRad(val));
                    const tan = (val) => Math.tan(toRad(val));
                    const log = (val) => Math.log10(val);
                    const ln = (val) => Math.log(val);
                    const sqrt = (val) => Math.sqrt(val);

                    const computeFunc = new Function(
                        'sin', 'cos', 'tan', 'log', 'ln', 'sqrt',
                        'return ' + evalString
                    );

                    let res = computeFunc(sin, cos, tan, log, ln, sqrt);
                    res = Math.round(res * 1000000000) / 1000000000;
                    
                    this.result = res.toString();
                    this.addToHistory(originalExpression, this.result);
                    this.expression = this.result;
                    this.updateDisplay();

                } catch (e) {
                    this.expression = "Error";
                    this.updateDisplay();
                }
            }

            updateDisplay() {
                if (this.locale === 'hi') {
                    this.displayElement.classList.add('font-hindi');
                } else {
                    this.displayElement.classList.remove('font-hindi');
                }
                this.displayElement.innerText = this.formatForDisplay(this.expression || '0');
            }
        }

        const currentOperandTextElement = document.getElementById('current-operand');
        const historyListElement = document.getElementById('history-list');
        const calculator = new Calculator(currentOperandTextElement, historyListElement);

        document.querySelectorAll('button[data-val]').forEach(btn => {
            btn.addEventListener('click', () => {
                calculator.append(btn.getAttribute('data-val'));
            });
        });

        document.querySelectorAll('button[data-action]').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.getAttribute('data-action');
                if (action === 'clear') calculator.clear();
                if (action === 'delete') calculator.delete();
                if (action === 'equals') calculator.compute();
                if (action === 'bracket') calculator.bracket();
            });
        });

        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const body = document.body;
        const savedTheme = localStorage.getItem('calculator-theme') || 'dark';
        setTheme(savedTheme);

        themeToggleBtn.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        });

        function setTheme(theme) {
            body.setAttribute('data-theme', theme);
            localStorage.setItem('calculator-theme', theme);
            if (theme === 'dark') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        const langToggleBtn = document.getElementById('lang-toggle');
        let currentLang = 'en';
        const hindiDigits = ['०', '१', '२', '३', '४', '५', '६', '७', '८', '९'];
        const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
        const numButtons = document.querySelectorAll('[data-type="num"]');

        langToggleBtn.addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'hi' : 'en';
            const langIconSpan = langToggleBtn.querySelector('span');
            
            if (currentLang === 'hi') {
                langIconSpan.innerText = 'EN';
                langIconSpan.classList.remove('font-hindi');
                body.classList.add('font-hindi'); 
            } else {
                langIconSpan.innerText = 'अ';
                langIconSpan.classList.add('font-hindi');
                body.classList.remove('font-hindi');
            }
            calculator.setLocale(currentLang);
            numButtons.forEach(btn => {
                const val = btn.getAttribute('data-val');
                if (val === '.') return;
                btn.innerText = currentLang === 'hi' ? hindiDigits[parseInt(val)] : englishDigits[parseInt(val)];
                if (currentLang === 'hi') btn.classList.add('font-hindi');
                else btn.classList.remove('font-hindi');
            });
        });

        const sciToggleBtn = document.getElementById('sci-toggle');
        const sciIcon = document.getElementById('sci-icon'); 
        const sciText = document.getElementById('sci-text');
        const calculatorFrame = document.getElementById('calculator-frame');
        const keypad = document.getElementById('keypad');
        let isSciMode = false;

        sciToggleBtn.addEventListener('click', () => {
            isSciMode = !isSciMode;
            if (isSciMode) {
                calculatorFrame.classList.remove('sci-hidden');
                calculatorFrame.style.maxWidth = "440px";
                keypad.classList.remove('grid-cols-4');
                keypad.classList.add('grid-cols-5');
                sciToggleBtn.style.width = '100px'; 
                sciToggleBtn.style.borderRadius = '9999px'; 
                sciToggleBtn.style.backgroundColor = 'var(--back-btn-bg)';
                sciToggleBtn.style.color = 'var(--back-btn-text)';
                sciIcon.classList.remove('fa-flask');
                sciIcon.classList.add('fa-chevron-left');
                sciText.classList.remove('opacity-0', 'w-0');
                sciText.classList.add('opacity-100', 'w-auto');
            } else {
                calculatorFrame.classList.add('sci-hidden');
                calculatorFrame.style.maxWidth = "360px";
                keypad.classList.remove('grid-cols-5');
                keypad.classList.add('grid-cols-4');
                sciToggleBtn.style.width = '2.5rem'; 
                sciToggleBtn.style.backgroundColor = 'var(--btn-bg)';
                sciToggleBtn.style.color = 'var(--sci-icon)';
                sciIcon.classList.remove('fa-chevron-left');
                sciIcon.classList.add('fa-flask');
                sciText.classList.remove('opacity-100', 'w-auto');
                sciText.classList.add('opacity-0', 'w-0');
            }
        });

        const historyToggleBtn = document.getElementById('history-toggle');
        const historyView = document.getElementById('history-view');
        const clearHistoryBtn = document.getElementById('clear-history');
        let isHistoryOpen = false;

        historyToggleBtn.addEventListener('click', () => {
            isHistoryOpen = !isHistoryOpen;
            if(isHistoryOpen) {
                historyView.classList.remove('translate-y-full');
                historyToggleBtn.style.backgroundColor = 'var(--history-icon)';
                historyToggleBtn.querySelector('i').style.color = 'white';
            } else {
                historyView.classList.add('translate-y-full');
                historyToggleBtn.style.backgroundColor = 'var(--btn-bg)';
                historyToggleBtn.querySelector('i').style.color = 'var(--history-icon)';
            }
        });

        clearHistoryBtn.addEventListener('click', () => {
            calculator.clearHistory();
        });

        document.addEventListener('keydown', (e) => {
            const key = e.key;
            if ((key >= '0' && key <= '9') || key === '.') calculator.append(key);
            if (key === '+' || key === '-') calculator.append(key);
            if (key === '*') calculator.append('×');
            if (key === '/') { e.preventDefault(); calculator.append('÷'); }
            if (key === '(' || key === ')') calculator.append(key);
            if (key === 'Enter' || key === '=') { e.preventDefault(); calculator.compute(); }
            if (key === 'Backspace') calculator.delete();
            if (key === 'Escape') calculator.clear();
        });
    </script>
</body>
</html>